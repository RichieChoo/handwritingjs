# dp 思路解股票

## 题目

给定一个整数数组 prices ，它的第 i 个元素 prices[i] 是一支给定的股票在第 i 天的价格。
设计一个算法来计算你所能获取的最大利润。你最多可以完成 k 笔交易。
注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。

## 分析

每天都有三种「选择」：买入、卖出、无操作
我们用 buy, sell, rest(用 1 表示持有，0 表示没有持有)
问题的「状态」有三个：天数、允许交易的最大次数、当前的持有状态

dp[i][k][0 or 1]
0<=i<=n-1, 1<=k<=K
n 为天数、K 为最多交易次数
共 n*k*2 种状态

比如说 dp[3][2][1] 的含义就是：今天是第三天，我现在手上持有着股票，至今最多进行 2 次交易。

最终要求是：dp[n - 1][k][0]，即最后一天，最多允许 K 次交易，所能获取的最大利润

## 状态转移方程

dp[i][k][0] = max (dp[i-1][k][0],dp[i-1][k][1]+prices[i])
第 i 天没有持有: 第 i-1 天没有持有/第 i-1 天持有后卖出

dp[i][k][1] = max (dp[i-1][k][1],dp[i-1][k-1][0]-prices[i])
第 i 天持有: 第 i-1 天就持有/第 i-1 天没有持有后买入

## base case

dp[-1][k][0]=0: 没有开始，利润 0
dp[-1][k][1]=-Infinity: 没有开始，不会持有
dp[i][0][0]=0: k>1,k===0 不允许交易， 利润 0
dp[i][0][1]=-Infinity: 不允许交易,不会持有

## start

### k=1

dp[i][1][0] = max (dp[i-1][1][0],dp[i-1][1][1]+prices[i])
dp[i][1][1] = max (dp[i-1][1][1],dp[i-1][0][0]-prices[i])
|
V
dp[i][0] = max(dp[i-1][0],dp[i-1][1]+prices[i])
dp[i][1] = max(dp[i-1][1],-prices[i])

### k=Infinity

dp[i][k][0] = max (dp[i-1][k][0],dp[i-1][k][1]+prices[i])
dp[i][k][1] = max (dp[i-1][k][1],dp[i-1][k-1][0]-prices[i])
|
V
dp[i][0] = max (dp[i-1][0],dp[i-1][1]+prices[i])
dp[i][1] = max (dp[i-1][1],dp[i-1][0]-prices[i])

### k=2

dp[i][k][0] = max (dp[i-1][k][0],dp[i-1][k][1]+prices[i])
dp[i][k][1] = max (dp[i-1][k][1],dp[i-1][k][0]-prices[i])
|
V
dp[i][2][0] = max(dp[i-1][2][0],dp[i-1][2][1]+prices[i])
dp[i][2][1] = max(dp[i-1][2][1],dp[i-1][1][0]-prices[i])
dp[i][1][0] = max(dp[i-1][1][0],dp[i-1][1][1]+prices[i])
dp[i][1][1] = max(dp[i-1][1][1],dp[i-1][0][0]-prices[i])

### k= any
